{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Counter Dashboard - {{ site_title|default:"Django site admin" }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; Counter Dashboard
</div>
{% endblock %}

{% block content %}
<h1>Counter Dashboard</h1>

<div class="module aligned">
    <h2>Counter Statistics</h2>
    <table>
        <tr>
            <th>Metric</th>
            <th>Count</th>
        </tr>
        <tr>
            <td>Category-Country Records</td>
            <td>{{ category_country_count }}</td>
        </tr>
        <tr>
            <td>Category-Country-City Records</td>
            <td>{{ category_country_city_count }}</td>
        </tr>
        <tr>
            <td>Category-City-Town Records</td>
            <td>{{ category_city_town_count }}</td>
        </tr>
        <tr>
            <td>Last Rebuild</td>
            <td>
                {% if last_rebuild %}
                    {{ last_rebuild.rebuilt_at|date:"Y-m-d H:i:s" }} ({{ last_rebuild.rebuild_type }})
                {% else %}
                    Never
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<div class="module aligned">
    <h2>Rebuild Actions</h2>
    
    <form method="post" style="margin-bottom: 20px;">
        {% csrf_token %}
        <input type="hidden" name="action" value="rebuild_all">
        <input type="submit" value="Rebuild All Counters" class="default" onclick="return confirm('Are you sure? This will rebuild all counter tables.')">
        <p class="help">Rebuilds all counter tables from scratch. Use this after bulk imports or data corrections.</p>
    </form>
    
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="rebuild_category">
        <label for="category_id">Category ID:</label>
        <input type="number" name="category_id" id="category_id" required>
        <input type="submit" value="Rebuild Category Counters">
        <p class="help">Rebuilds counters for a specific category only. Enter the category ID.</p>
    </form>
</div>

<div class="module aligned">
    <h2>Recent Rebuilds</h2>
    <p><a href="{% url 'admin:counters_counterrebuildlog_changelist' %}">View all rebuild logs</a></p>
</div>

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

{% endblock %}