<!-- templates/includes/dynamic_map.html -->
<section class="map-wrap" data-location-type="{{ location_type }}" data-location-code="{{ location_code }}">
  <!-- Dynamic map that zooms based on location -->
  <iframe class="map-embed" 
    id="dynamic-map"
    src="{{ map_url }}"
    loading="lazy" 
    referrerpolicy="no-referrer-when-downgrade">
  </iframe>

  <!-- Search bar overlay -->
  <div class="searchbar">
    <input type="text" id="map-search" placeholder="Search for a business, cityâ€¦" />
    <select id="location-filter">
      <option value="europe">Europe</option>
      {% if location_type == 'country' %}
        <option value="{{ location_code }}" selected>{{ location_code }}</option>
      {% elif location_type == 'city' %}
        <option value="{{ location_code }}" selected>{{ location_code|title }}</option>
      {% endif %}
    </select>
    <select id="category-filter">
      <option value="">Category</option>
    </select>
    <button type="button" onclick="performMapSearch()">Search</button>
  </div>
</section>

<script>
// Store map coordinates for JavaScript use
window.mapConfig = {
  coordinates: {{ coordinates|safe }},
  locationType: '{{ location_type }}',
  locationCode: '{{ location_code }}'
};
</script>